@use 'sass:map';
@use 'sass:meta';
@use 'sass:string';
@use 'sass:list';
@use 'vars' as *;

// ============================================
// Mixins
// ============================================

// Font path
$font-path: '../fonts/';

// String Replace (for font-face)
@function str-replace($str, $search, $replace: '') {
  $index: string.index($str, $search);

  @if $index {
    @return string.slice($str, 1, $index - 1) + $replace + str-replace(string.slice($str, $index + string.length($search)), $search, $replace);
  }

  @return $str;
}

// Font Face mixin
@mixin font-face($name, $path, $weight: null, $style: null, $exts: woff2 woff) {
  $src: null;

  $extmods: (
    eot: '?',
    svg: '#' + str-replace($name, ' ', '_')
  );

  $formats: (
    otf: 'opentype',
    ttf: 'truetype'
  );

  @each $ext in $exts {
    $extmod: $ext;
    @if map.has-key($extmods, $ext) {
      $extmod: $ext + map.get($extmods, $ext);
    }
    
    $format: $ext;
    @if map.has-key($formats, $ext) {
      $format: map.get($formats, $ext);
    }
    
    $src: list.append($src, url(string.quote($font-path + $path + '.' + $extmod)) format(string.quote($format)), comma);
  }

  @font-face {
    font-family: string.quote($name);
    font-style: $style;
    font-weight: $weight;
    font-display: swap;
    src: $src;
  }
}

// Normalize list
@mixin normalize-list {
  padding: 0;
  margin: 0;
  list-style: none;
}

// Media queries
@mixin sm {
  @media screen and (min-width: $sm) {
    @content;
  }
}

@mixin md {
  @media screen and (min-width: $md) {
    @content;
  }
}

@mixin lg {
  @media screen and (min-width: $lg) {
    @content;
  }
}

@mixin xl {
  @media screen and (min-width: $xl) {
    @content;
  }
}

// Custom breakpoint
@mixin breakpoint($size) {
  @media screen and (min-width: $size) {
    @content;
  }
}

// Max-width media query
@mixin max($size) {
  @media screen and (max-width: ($size - 1px)) {
    @content;
  }
}

// Visually hidden (for accessibility)
@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Truncate text with ellipsis
@mixin truncate($lines: 1) {
  @if $lines == 1 {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

// Flex center
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

// Absolute center
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

// Reset button styles
@mixin reset-button {
  padding: 0;
  border: none;
  background: none;
  cursor: pointer;
  font: inherit;
  color: inherit;
}

// Smooth scroll
@mixin smooth-scroll {
  scroll-behavior: smooth;

  @media (prefers-reduced-motion: reduce) {
    scroll-behavior: auto;
  }
}

// Focus visible
@mixin focus-visible {
  &:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }
}

// Hover with media query support
@mixin hover {
  @media (hover: hover) and (pointer: fine) {
    &:hover {
      @content;
    }
  }
}

// Container
@mixin container($max-width: 1320px, $padding: 16px) {
  width: 100%;
  max-width: $max-width;
  margin-inline: auto;
  padding-inline: $padding;
}
